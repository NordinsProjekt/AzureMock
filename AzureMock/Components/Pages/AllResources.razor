@page "/all-resources"
@layout AzurePortalLayout
@rendermode InteractiveServer

<PageTitle>All Resources - Microsoft Azure</PageTitle>

<div class="azure-container">
    <div class="azure-breadcrumb">
        <a href="/">Home</a>
        <span>/</span>
        <span>All Resources</span>
    </div>

    <h1 class="azure-page-title">All Resources</h1>

    <div class="azure-resources">
        @if (AllResourcesList.Any())
        {
            <table class="azure-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Resource Group</th>
                        <th>Location</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var resource in AllResourcesList)
                    {
                        <tr>
                            <td>
                                @if (resource.Type == "SQL Server")
                                {
                                    <a href="/sql-servers/@resource.Name" class="azure-action-link">@resource.Name</a>
                                }
                                else
                                {
                                    <span>@resource.Name</span>
                                }
                            </td>
                            <td>@resource.Type</td>
                            <td>@resource.ResourceGroup</td>
                            <td>@resource.Location</td>
                            <td><span class="azure-badge azure-badge-@(resource.Status.ToLower())">@resource.Status</span></td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="azure-empty-state">
                <svg viewBox="0 0 64 64" fill="currentColor">
                    <rect x="12" y="12" width="18" height="18" rx="2"/>
                    <rect x="34" y="12" width="18" height="18" rx="2"/>
                    <rect x="12" y="34" width="18" height="18" rx="2"/>
                    <rect x="34" y="34" width="18" height="18" rx="2"/>
                </svg>
                <h3>No Resources</h3>
                <p>Start creating resources to see them here</p>
                <button class="azure-button azure-button-primary" @onclick='() => Navigation.NavigateTo("/create-sql-server")' style="margin-top: 16px;">
                    + Create SQL Server
                </button>
            </div>
        }
    </div>
</div>

@code {
    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    [Inject]
    private AzureResourceService ResourceService { get; set; } = default!;

    private List<ResourceItem> AllResourcesList { get; set; } = new();

    protected override void OnInitialized()
    {
        LoadAllResources();
    }

    private void LoadAllResources()
    {
        AllResourcesList = new List<ResourceItem>();

        // Add SQL Servers
        foreach (var server in ResourceService.GetSqlServers())
        {
            AllResourcesList.Add(new ResourceItem
            {
                Name = server.Name,
                Type = "SQL Server",
                ResourceGroup = server.ResourceGroup,
                Location = server.Location,
                Status = server.Status
            });

            // Add databases
            foreach (var db in server.Databases)
            {
                AllResourcesList.Add(new ResourceItem
                {
                    Name = $"{server.Name}/{db.Name}",
                    Type = "SQL Database",
                    ResourceGroup = server.ResourceGroup,
                    Location = server.Location,
                    Status = db.Status
                });
            }
        }

        AllResourcesList = AllResourcesList.OrderBy(r => r.Name).ToList();
    }

    private class ResourceItem
    {
        public string Name { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public string ResourceGroup { get; set; } = string.Empty;
        public string Location { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
    }
}
